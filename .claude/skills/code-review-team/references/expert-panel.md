# 전문가 패널 구성 가이드

> 프로젝트 프로파일을 기반으로 리뷰 관점을 동적으로 결정합니다.

---

## 원칙

1. **프로젝트가 정의한 규칙이 최우선** — 일반적인 베스트 프랙티스보다 CLAUDE.md, lint 설정 등 명시된 규칙을 기준으로 판단
2. **감지된 기술 스택에 맞는 관점만 추가** — 사용하지 않는 기술에 대한 리뷰는 노이즈
3. **최소 2개, 최대 5개 관점** — 너무 적으면 허술하고 너무 많으면 산만함

---

## 기본 관점 (항상 포함)

### 프로젝트 규칙 준수

CLAUDE.md, rules, lint/format 설정에 정의된 규칙 위반 여부를 검토합니다.

**탐색 결과에서 추출하는 항목:**
- CLAUDE.md의 `## Rules`, `## Convention`, `## Guidelines` 등 섹션
- `.eslintrc`, `ruff.toml`, `biome.json` 등의 활성 규칙
- 스킬로 정의된 코딩 컨벤션 (`user-invocable: false` 스킬)
- `.editorconfig`, `prettier` 등 포맷팅 규칙

**리뷰 질문:**
- 변경된 코드가 프로젝트 명시 규칙을 따르는가?
- 기존 코드베이스의 패턴/관례와 일치하는가?
- 등록된 스킬/에이전트가 기대하는 구조를 위반하지 않는가?

### 정확성

프로젝트 규칙과 무관하게 코드의 올바름을 검토합니다.

**리뷰 질문:**
- 로직이 의도대로 동작하는가? (조건문, 반복, 경계값)
- 에러/예외 상황이 적절히 처리되는가?
- 엣지 케이스가 누락되지 않았는가?
- null/undefined/빈 값에 대한 방어가 있는가?

---

## 조건부 관점 (프로파일에 따라 추가)

### 감지 조건 → 관점 매핑

| 감지 신호 | 추가 관점 | 핵심 검토 내용 |
|-----------|-----------|----------------|
| 웹 프레임워크 (Express, Next, Django, Rails 등) | **보안** | 입력 검증, 인증/인가, 인젝션, 시크릿 노출 |
| DB/ORM (Prisma, TypeORM, SQLAlchemy, GORM 등) | **데이터 계층** | 쿼리 효율성, 트랜잭션, 마이그레이션 일관성 |
| 테스트 프레임워크 (Jest, Pytest, Go test 등) | **테스트 충분성** | 변경에 대한 테스트 커버리지, 테스트 품질 |
| 상태 관리 (Redux, Zustand, Pinia 등) | **상태 관리** | 상태 구조, 불변성, 사이드 이펙트 처리 |
| 인프라 설정 (Docker, K8s, Terraform 등) | **인프라/배포** | 설정 안전성, 환경 분리, 시크릿 관리 |
| API 정의 (OpenAPI, GraphQL schema 등) | **API 설계** | 인터페이스 일관성, 하위호환, 에러 응답 |
| 동시성 코드 (goroutine, async, thread 등) | **동시성** | 경쟁 조건, 데드락, 자원 정리 |

### 관점별 리뷰 질문

관점이 추가되면 해당 영역에 특화된 질문으로 코드를 검토합니다.

**보안:**
- 사용자 입력이 검증/이스케이프 없이 사용되는 곳이 있는가?
- 인증/인가 체크가 누락된 엔드포인트가 있는가?
- 시크릿, API 키 등이 코드에 하드코딩되었는가?

**데이터 계층:**
- 루프 안에서 쿼리가 실행되는가? (N+1)
- 트랜잭션 범위가 적절한가?
- 스키마 변경이 기존 데이터와 호환되는가?

**테스트 충분성:**
- 변경된 로직에 대한 테스트가 추가/수정되었는가?
- 테스트가 실제 동작을 검증하는가? (구현 세부가 아닌)
- 엣지 케이스 테스트가 있는가?

**상태 관리:**
- 상태 변이가 예측 가능한 방식으로 일어나는가?
- 불필요한 리렌더링을 유발하는 구조는 없는가?
- 비동기 상태의 로딩/에러 상태가 처리되는가?

**인프라/배포:**
- 환경별 설정이 분리되어 있는가?
- 시크릿이 환경 변수로 관리되는가?
- 컨테이너 이미지 태그가 고정되어 있는가?

**API 설계:**
- 기존 클라이언트와의 하위호환이 유지되는가?
- 에러 응답 형식이 일관적인가?
- 필드 네이밍이 API 컨벤션을 따르는가?

**동시성:**
- 공유 자원 접근이 안전하게 보호되는가?
- 고루틴/스레드가 적절히 종료되는가?
- 채널/락이 데드락 없이 사용되는가?

---

## 이슈 기술 형식

각 이슈는 **어떤 전문가 관점에서 발견**되었는지 태그합니다.

```
[관점] 파일:라인 — 이슈 설명
근거: 구체적 코드/규칙 참조
개선 방향: 무엇을 어떻게 바꾸면 좋을지 (구체적 코드 아닌 방향)
```

예시:

```
[프로젝트 규칙] src/api/handler.ts:45 — CLAUDE.md에 정의된 에러 응답 형식 미준수
근거: CLAUDE.md "## Error Handling" 섹션에서 `{ error: { code, message } }` 형식 요구,
      실제 코드는 `{ message: string }` 반환
개선 방향: 에러 응답을 프로젝트 표준 형식에 맞게 구조화

[보안] src/auth/login.ts:23 — 사용자 입력이 검증 없이 DB 쿼리에 전달됨
근거: `req.body.email`이 직접 `findByEmail(email)`에 전달, 타입/형식 검증 없음
개선 방향: 입력 검증 레이어 추가
```
