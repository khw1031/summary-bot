# Step 1: 요구사항 분석

> **컨텍스트 경계**
> 이 Step은 독립적인 분석 세션입니다. 이전 대화 맥락을 배제하고 아래 지시사항만 따르세요.
> 이렇게 하는 이유: 제공된 리소스(PRD, Figma, Swagger 등)를 선입견 없이 개발 관점에서 해석해야 합니다.

---

## 규칙 로드 (필수)

**이 Step을 시작하기 전에 다음 규칙을 로드하세요:**

1. **규칙 인덱스 읽기**: [assets/rules/AGENTS.md](../assets/rules/AGENTS.md)
2. **필수 규칙 로드**: `MUST/workflow-rule.md` (항상)
3. **도메인 규칙 확인**: 작업 컨텍스트에 따라 동적 로드
   - 예: React 관련 → `react/AGENTS.md`
   - 예: 테스트 관련 → `testing/AGENTS.md`

**빠른 체크:**

```
□ MUST/workflow-rule.md 로드함
□ Step 1 입력 파일: 00-user-prompt.md 존재 확인
□ status.yaml에서 현재 상태 확인
```

---

## 역할 그룹 정의

요구사항 해석, 갭 분석, 기술적 의사결정에 전문성을 가진 **Development Analysis 전문가 그룹**이 다음 관점에서 제공된 리소스를 분석한다고 시뮬레이션하세요:

| 관점                | 분석 초점                                       |
| ------------------- | ----------------------------------------------- |
| **스펙 해석가**     | PRD/Figma/Swagger에서 구현 범위와 세부사항 추출 |
| **갭 분석가**       | 제공된 리소스에서 누락되거나 모호한 부분 식별   |
| **기술 의사결정자** | 구현 방향, 아키텍처 선택, 기술적 제약 분석      |
| **의존성 분석가**   | 외부/내부 의존성, 블로커, 리스크 식별           |

각 관점의 분석 결과를 종합하여 개발팀용 요구사항 분석 문서를 도출합니다.

## 책임

1. **리소스 해석**: PRD, Figma, Swagger 등 제공된 리소스를 개발 관점에서 해석합니다.
2. **갭 분석**: 제공된 리소스에서 누락된 정보, 모호한 부분, 충돌하는 내용을 식별합니다.
3. **기술적 결정**: 구현 방향, 기술 스택 선택 등 개발에 필요한 결정 사항을 정리합니다.
4. **의존성/리스크 파악**: 외부 팀 의존성, 블로커, 잠재적 리스크를 식별합니다.

---

## 작업 흐름

### Phase 0: 환경 설정

브랜치 생성 (사용자에게 브랜치명 제안 후 확인):

```bash
git switch -c feat/<TASK_ID>-<description>
```

### Phase 1: 입력 및 출력 구조 파악

**입력 수집:**
`.ai/tasks/<TASK_ID>/00-user-prompt.md` 파일을 읽고 제공된 리소스 링크를 확인합니다:

- PRD 문서
- Figma 디자인
- Swagger/API 스펙
- 기타 참조 자료

**출력 구조 파악:**
[assets/templates/10-output-plan.md](assets/templates/10-output-plan.md)를 읽고 다음을 확인합니다:

- 채워야 할 섹션 목록
- 각 섹션에서 요구하는 정보 유형

> 💡 **원칙**: 최종 산출물 형태를 먼저 파악해야 분석 방향이 명확해집니다.

### Phase 2: 다관점 분석 (템플릿 섹션별)

| 템플릿 섹션             | 담당 관점               | 수집할 정보                        |
| ----------------------- | ----------------------- | ---------------------------------- |
| 1. 리소스 참조          | 스펙 해석가             | 제공된 리소스 목록, 버전, 링크     |
| 2. 스코프 요약          | 스펙 해석가             | 구현 목표, 대상 화면, 관련 API     |
| 3. 리소스 갭 분석       | 갭 분석가               | PRD/Figma/API 누락/모호 사항       |
| 4. 기술적 결정 사항     | 기술 의사결정자         | 구현 방향, 기술 선택, 제약         |
| 5. 화면-API 매핑        | 스펙 해석가             | Figma 화면과 API 엔드포인트 연결   |
| 6. 의존성 분석          | 의존성 분석가           | 외부/내부 의존성, 블로커           |
| 7. 리스크 식별          | 의존성 분석가           | 리스크, 영향도, 대응 방안          |
| 8. 핵심 테스트 시나리오 | 스펙 해석가 + 갭 분석가 | Given-When-Then 시나리오, 우선순위 |
| 9. 완료 검증 체크리스트 | 전체                    | 완료 확인 기준                     |
| 10. 미결 사항           | 갭 분석가               | 확인 필요 질문, 담당자             |
| 11. 다음 단계           | 전체                    | Step 2 진입 전 완료 조건           |

### Phase 3: 리소스별 상세 분석

**PRD 분석 (스펙 해석가 + 갭 분석가):**

- 핵심 요구사항 추출
- 우선순위 확인 (있는 경우)
- 불명확하거나 모호한 부분 식별
- 구현에 필요하지만 명시되지 않은 정보 파악

**Figma 분석 (스펙 해석가 + 갭 분석가):**

- 구현 대상 화면 목록화
- 각 화면의 상태 확인 (정상/로딩/에러/빈 상태)
- 반응형 디자인 정의 여부
- 인터랙션 명세 확인
- 누락된 UI 상태 식별

**Swagger/API 분석 (스펙 해석가 + 갭 분석가):**

- 사용할 엔드포인트 목록
- 요청/응답 스키마 확인
- 에러 응답 형식 확인
- 필요하지만 누락된 API 식별

**테스트 시나리오 도출 (스펙 해석가 + 갭 분석가):**

각 리소스에서 테스트 시나리오를 추출합니다:

| 소스    | 추출 대상                  | 예시                              |
| ------- | -------------------------- | --------------------------------- |
| PRD     | 비즈니스 규칙, 성공 기준   | "수량 0 이하 입력 시 에러"        |
| Figma   | UI 상태 전환, 인터랙션     | "로딩 → 성공/에러 상태 전환"      |
| Swagger | API 요청/응답, 에러 케이스 | "401 시 로그인 페이지 리다이렉트" |

> 💡 **TDD 원칙**: "무엇을 테스트해야 하는가"만 정의합니다.
> "어떻게 테스트할 것인가"(Mock 전략, 테스트 구조)는 Step 2에서 결정합니다.

### Phase 4: 기술적 결정 및 의존성 분석

**기술 의사결정자:**

- 구현 방향 결정이 필요한 항목 식별
- 선택지와 트레이드오프 정리
- 기술적 제약 조건 파악

**의존성 분석가:**

- 외부 팀/시스템 의존성 식별
- 블로커 여부 및 해소 일정 확인
- 내부 코드베이스 의존성 파악
- 리스크 및 대응 방안 정리

### Phase 5: 명확화 질의

리소스에서 파악한 갭이나 모호한 부분에 대해 **사용자(또는 PM/디자이너)에게 질문**하세요.
가정하지 말고 확인하세요.

### Phase 6: 산출물 작성

- **템플릿**: [assets/templates/10-output-plan.md](assets/templates/10-output-plan.md)
- **출력 위치**: `.ai/tasks/<TASK_ID>/10-output-plan.md`

---

## 경계 조건

| 허용                        | 금지                   | 이유                                     |
| --------------------------- | ---------------------- | ---------------------------------------- |
| PRD/Figma/Swagger 분석      | 요구사항 재정의        | 제공된 리소스 해석이 목적                |
| 코드베이스 구조 탐색        | 구현 세부사항 분석     | 연관성 파악은 필요, 솔루션 결정은 Step 2 |
| 갭/누락 사항 식별           | 임의로 채워넣기        | 확인 없이 가정하지 않음                  |
| 기술적 결정 항목 정리       | 최종 결정 확정         | 팀 합의 필요 사항은 미결로 남김          |
| 테스트 시나리오 정의 (What) | 테스트 구현 전략 (How) | Mock 전략, 테스트 구조는 Step 2          |
| -                           | 사용자 미확인 진행     | 분석 결과는 반드시 승인 필요             |

---

## 완료 프로토콜

### 검증 체크리스트

모든 항목이 충족되어야 완료 가능:

- [ ] 제공된 리소스(PRD, Figma, Swagger) 모두 검토함
- [ ] 스코프 요약이 명확히 정의됨
- [ ] PRD/Figma/API 갭 분석 완료
- [ ] 기술적 결정 필요 항목 정리됨
- [ ] 화면-API 매핑 완료
- [ ] 외부/내부 의존성 식별됨
- [ ] 리스크 및 대응 방안 정리됨
- [ ] 핵심 테스트 시나리오(Given-When-Then) 정의됨
- [ ] 미결 사항이 질문으로 정리됨
- [ ] 10-output-plan.md 작성 완료

---

## 작업 절차

### 0. Git 브랜치 설정

작업 시작 전 새 브랜치를 생성합니다:

```bash
# 브랜치명 입력받기 (예: feature/PROJ-001-user-auth)
# 사용자에게 브랜치명을 제안하고 수정 여부 확인
git switch -c <branch-name>
```

**브랜치명 규칙**:

- `feature/<TASK_ID>-<description>`: 새 기능
- `fix/<TASK_ID>-<description>`: 버그 수정
- `refactor/<TASK_ID>-<description>`: 리팩토링

### 1. 입력 파일 및 템플릿 읽기

1. `.ai/tasks/<TASK_ID>/00-user-prompt.md` 파일을 읽습니다.
2. [assets/templates/10-output-plan.md](../assets/templates/10-output-plan.md) 템플릿을 읽습니다.

### 2. 제공된 리소스 분석

다음 질문에 답하며 각 리소스를 분석합니다:

**PRD:**

- 핵심 구현 목표는 무엇인가?
- 명시된 요구사항과 암묵적 요구사항은?
- 불명확하거나 모호한 부분은?

**Figma:**

- 구현 대상 화면은 몇 개인가?
- 각 화면의 상태(정상/로딩/에러/빈)가 정의되어 있는가?
- 반응형, 인터랙션이 명시되어 있는가?

**Swagger/API:**

- 필요한 API가 모두 정의되어 있는가?
- 요청/응답 스키마가 명확한가?
- 에러 처리가 정의되어 있는가?

### 3. 갭 분석

제공된 리소스에서 누락되거나 불명확한 부분을 식별합니다.

### 4. 기술적 결정 사항 정리

구현 방향 결정이 필요한 항목을 정리합니다.

### 5. 의존성 및 리스크 분석

외부/내부 의존성과 잠재적 리스크를 식별합니다.

### 6. 출력 문서 작성

템플릿을 참고하여 분석 결과를 작성합니다.

## 주의사항

- **제공된 리소스 중심**: PRD, Figma, Swagger 등 제공된 리소스를 해석하는 것이 목적입니다.
- **가정하지 마세요**: 불명확한 부분은 질문으로 정리하고 확인받으세요.
- **구현 방법은 Step 2에서**: 상세 설계와 구현 방향 확정은 Step 2에서 수행합니다.
- **사용자 확인 필수**: 분석 결과를 사용자에게 보여주고 승인받은 후 진행합니다.

## 출력 가이드

[assets/templates/10-output-plan.md](../assets/templates/10-output-plan.md) 형식을 따르세요.

출력 파일 위치: `.ai/tasks/<TASK_ID>/10-output-plan.md`

---

## 완료 처리

### 1. 사용자 확인 (필수)

체크리스트를 모두 만족했다면 사용자에게 확인합니다:

```
📋 Step 1 체크리스트 완료 확인:
- [ ] 제공된 리소스(PRD, Figma, Swagger) 모두 검토함
- [ ] 스코프 요약 정의됨
- [ ] 갭 분석 완료
- [ ] 기술적 결정 항목 정리됨
- [ ] 화면-API 매핑 완료
- [ ] 의존성/리스크 식별됨
- [ ] 핵심 테스트 시나리오 정의됨
- [ ] 미결 사항 정리됨
- [ ] 출력 파일 작성 완료

👉 Step 1을 완료 처리할까요?
```

> ⚠️ **사용자 승인 없이 다음 단계로 진행하지 마세요.**

### 2. 승인 후 처리

사용자가 승인하면 다음을 수행합니다:

#### Git 커밋

```bash
git add .ai/tasks/<TASK_ID>/10-output-plan.md
git commit -m "feat/<TASK_ID>-[AI]: Completed Step 1 requirements analysis"
```

#### status.yaml 업데이트

```yaml
current_step: step-2
steps:
  step-1:
    status: completed
  step-2:
    status: pending
```

### 3. 다음 Step 안내

```
✅ Step 1 완료!

새 대화에서 다음 명령어로 Step 2를 시작하세요:
"<TASK_ID> 작업 이어서 진행해줘"
```
